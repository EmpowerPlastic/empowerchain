{
  "version": 3,
  "sources": ["../../node_modules/@segment/analytics-next/src/plugins/remote-middleware/index.ts"],
  "sourcesContent": ["import { LegacySettings } from '../../browser'\nimport { Context } from '../../core/context'\nimport { isServer } from '../../core/environment'\nimport { loadScript } from '../../lib/load-script'\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn'\nimport { MiddlewareFunction } from '../middleware'\n\nexport async function remoteMiddlewares(\n  ctx: Context,\n  settings: LegacySettings,\n  obfuscate?: boolean\n): Promise<MiddlewareFunction[]> {\n  if (isServer()) {\n    return []\n  }\n  const path = getNextIntegrationsURL()\n  const remoteMiddleware = settings.enabledMiddleware ?? {}\n  const names = Object.entries(remoteMiddleware)\n    .filter(([_, enabled]) => enabled)\n    .map(([name]) => name)\n\n  const scripts = names.map(async (name) => {\n    const nonNamespaced = name.replace('@segment/', '')\n    let bundleName = nonNamespaced\n    if (obfuscate) {\n      bundleName = btoa(nonNamespaced).replace(/=/g, '')\n    }\n    const fullPath = `${path}/middleware/${bundleName}/latest/${bundleName}.js.gz`\n\n    try {\n      await loadScript(fullPath)\n      // @ts-ignore\n      return window[`${nonNamespaced}Middleware`] as MiddlewareFunction\n    } catch (error: any) {\n      ctx.log('error', error)\n      ctx.stats.increment('failed_remote_middleware')\n    }\n  })\n\n  let middleware = await Promise.all(scripts)\n  middleware = middleware.filter(Boolean)\n\n  return middleware as MiddlewareFunction[]\n}\n"],
  "mappings": ";;;;;;;;;;;;AAOM,SAAgB,kBACpB,KACA,UACA,WAAmB;;;;;;;;AAEnB,cAAI,SAAQ,GAAI;AACd,mBAAA,CAAA,GAAO,CAAA,CAAE;;AAEL,iBAAO,uBAAsB;AAC7B,8BAAmB,KAAA,SAAS,uBAAiB,QAAA,OAAA,SAAA,KAAI,CAAA;AACjD,kBAAQ,OAAO,QAAQ,gBAAgB,EAC1C,OAAO,SAACA,KAAY;gBAAX,IAACA,IAAA,CAAA,GAAE,UAAOA,IAAA,CAAA;AAAM,mBAAA;UAAA,CAAO,EAChC,IAAI,SAACA,KAAM;gBAAL,OAAIA,IAAA,CAAA;AAAM,mBAAA;UAAA,CAAI;AAEjB,oBAAU,MAAM,IAAI,SAAO,MAAI;AAAA,mBAAA,UAAA,OAAA,QAAA,QAAA,WAAA;;;;;AAC7B,oCAAgB,KAAK,QAAQ,aAAa,EAAE;AAC9C,iCAAa;AACjB,wBAAI,WAAW;AACb,mCAAa,KAAK,aAAa,EAAE,QAAQ,MAAM,EAAE;;AAE7C,+BAAW,GAAA,OAAG,MAAI,cAAA,EAAA,OAAe,YAAU,UAAA,EAAA,OAAW,YAAU,QAAA;;;;AAGpE,2BAAA;sBAAA;sBAAM,WAAW,QAAQ;;;;AAAzB,oBAAAA,IAAA,KAAA;AAEA,2BAAA,CAAA,GAAO,OAAO,GAAA,OAAG,eAAa,YAAA,CAAY,CAAuB;;;AAEjE,wBAAI,IAAI,SAAS,OAAK;AACtB,wBAAI,MAAM,UAAU,0BAA0B;;;;;;;;;;WAEjD;AAEgB,iBAAA,CAAA,GAAM,QAAQ,IAAI,OAAO,CAAC;;AAAvC,uBAAa,GAAA,KAAA;AACjB,uBAAa,WAAW,OAAO,OAAO;AAEtC,iBAAA,CAAA,GAAO,UAAkC;;;;;",
  "names": ["_a"]
}
